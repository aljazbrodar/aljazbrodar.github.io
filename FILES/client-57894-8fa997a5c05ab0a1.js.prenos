"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[57894],{13773:(e,s,n)=>{n.d(s,{Z:()=>o});var t=n(30778),l=n(21888),i=n(74316),r=n(29839),u=n(64592);function o(){const e=(0,t.I0)(),{selectedVoucherUUID:s}=(0,l.v)((e=>{let{checkout:s}=e;return s}))||{},{data:n}=(0,i.t)(),{vouchers:o}=n||{};return function(e,s){const n=(0,r.ab)(e);if(e&&n)return{voucherData:e,voucherUUID:null==e?void 0:e.uuid};e&&!n&&s();return{voucherData:null,voucherUUID:null}}(s&&o?o[s]:null,(()=>e((0,u.rj)())))}},57894:(e,s,n)=>{n.d(s,{Pk:()=>Z,ZP:()=>g,IM:()=>b});var t=n(77808),l=n(37356),i=n(21888),r=n(30778),u=n(39069),o=n(42269),d=n(64592),a=n(76448),c=n(41679);var P=n(42359),p=n(90636),f=n(32912),B=n(63745),y=n(35077),m=n(91816),v=n(38370),h=n(17924),E=n(29808),x=n(13773),U=n(30763);const C=(e,s)=>({profileUUID:null==e?void 0:e.uuid,profileType:null==e?void 0:e.type,policyUUID:null==s?void 0:s.uuid,policyVersion:null==s?void 0:s.version});const S=e=>{const{user:s}=(0,a.Z)(),n=(0,r.I0)(),{vouchersData:l}=(0,p.Z)(),{businessPolicies:S,businessProfiles:D,getBusinessProfiles:I,onSelectBusinessProfile:Z,selectedBusinessProfile:b,selectedBusinessPolicy:g,businessExpenseCodes:O,searchBusinessExpenseCodes:k,selectedBusinessExpenseCode:M,setSelectedBusinessExpenseCode:F,getBackUrl:V,handleBusinessBackButton:w,selectedBusinessExpenseMemo:H,setSelectedBusinessExpenseMemo:T,setSelectedBusinessPolicy:G,requiresProfileFlow:L,currentStep:q,getInitialUrl:N,confirmedProfileSelected:A,setConfirmedProfileSelected:z,getBusinessDetails:R,hasBusinessProfile:_}=(0,c.Z)(),{selectedPersonalPayment:j,extraPaymentData:K,paymentProfiles:W,creditBalances:Y,useCredits:$,updateSelectedPersonalPayment:J,guestPaymentProfile:Q,setGuestPaymentProfile:X}=(0,P.Z)({businessProfiles:D}),ee=(0,i.v)((e=>e.checkout))||{},{selectedVoucherUUID:se,selectedBusinessPayment:ne}=ee,[te,le]=function(e){let{initialPaymentIntent:s}=e;const[n,l]=(0,t.useState)(s);return[n,l]}({initialPaymentIntent:"personal"});function ie(e){var s;if(le(e),"business"===e)return;const t=(null==l||null===(s=l.data)||void 0===s?void 0:s.vouchers)||{},i=se&&t[se];i&&n((0,d.wL)(i))}const{setSelectedBusinessExpenseCode:re,setSelectedBusinessExpenseMemo:ue,isValidPaymentSwitch:oe,updateDraftOrderPaymentProfile:de,updateDraftOrderError:ae,setUseCreditsForManagedBusiness:ce}=function(e){const s=(0,f.k6)(),n=(0,f.TH)(),l=(0,E.Z)(),i=(0,r.I0)(),d=(0,x.Z)(),a=(0,h.Ah)(l),{hasGroupOrder:c}=(0,y.Z)(),{updateDraftOrder:P,updateDraftOrderMaybe:p}=(0,U.Z)(),[S,D]=(0,t.useState)(!1),[I,Z]=(0,t.useState)(!1),b=Boolean(a),{groupOrder:g,getGroupOrder:O,shouldGetGroupOrder:k}=(0,m.Z)(a||"");(0,B.Z)((()=>k&&e.paymentIntent?O():null),[O,k,e],"use-business-draft-order");const M=(0,t.useCallback)((s=>{if(b&&!p.isLoading){const n=C(e.selectedBusinessProfile,e.selectedBusinessPolicy);P({draftOrderUUID:a||"",businessDetails:{...n,expenseCode:null==s?void 0:s.expenseCode}})}e.setSelectedBusinessExpenseCodeFn(s)}),[e,b,a,P,p]),F=(0,t.useCallback)((s=>{if(b&&!p.isLoading){var n;const t=C(e.selectedBusinessProfile,e.selectedBusinessPolicy);P({draftOrderUUID:a||"",businessDetails:{...t,expenseCode:null===(n=e.selectedBusinessExpenseCode)||void 0===n?void 0:n.expenseCode,expenseMemo:s}})}e.setSelectedBusinessExpenseMemoFn(s)}),[e,b,a,P,p]),V=(0,t.useCallback)((s=>{if(!b||!g.data)return null;var n,t,l;D(!1),s&&s.profileType===u.Hu.Business&&(delete s.voucherPolicyVersion,delete s.voucherUUID),s&&s.profileType===u.Hu.Personal&&null!=d&&d.voucherUUID&&(s.voucherPolicyVersion=null==d||null===(n=d.voucherData)||void 0===n||null===(t=n.policy)||void 0===t?void 0:t.version,s.voucherUUID=null==d?void 0:d.voucherUUID),i((0,o.GA)(s)),(null==s?void 0:s.profileType)===u.Hu.Personal&&null!==(l=e.selectedBusinessPolicy)&&void 0!==l&&l.isExpenseCodeRequired&&(e.setSelectedBusinessExpenseCodeFn(null),e.setSelectedBusinessExpenseMemoFn(null))}),[b,g.data,d,a,i,P,e.selectedBusinessProfile,e.selectedBusinessPolicy]);return(0,t.useEffect)((()=>{if(g.data&&"business"===e.paymentIntent&&e.selectedBusinessPolicy&&b){var s,n,t,l;const d={profileUUID:null===(s=e.selectedBusinessProfile)||void 0===s?void 0:s.uuid,profileType:null===(n=e.selectedBusinessProfile)||void 0===n?void 0:n.type,policyUUID:null===(t=e.selectedBusinessPolicy)||void 0===t?void 0:t.uuid,policyVersion:null===(l=e.selectedBusinessPolicy)||void 0===l?void 0:l.version};var r;D(!1),i((0,o.GA)(d)),i((0,o.eL)(I)),(null==d?void 0:d.profileType)!==u.Hu.Personal&&i((0,o.Nc)(null===(r=e.selectedBusinessProfile)||void 0===r?void 0:r.defaultPaymentProfileUuid))}}),[g,a,P,e.paymentIntent,e.selectedBusinessPolicy,e.selectedBusinessProfile,b,D,c,i,I]),(0,t.useEffect)((()=>{const e=(0,v.vN_)(n,"updateDraftOrderError");!S&&p.hasLoaded&&p.error&&(D(!0),s.replace(e))}),[p,D,S,s,n]),(0,t.useEffect)((()=>{var e;!S&&(null==n?void 0:n.search)!==(null===(e=(0,v.vN_)(n,"updateDraftOrderError"))||void 0===e?void 0:e.search)||!p.hasLoaded||p.error||(D(!1),s.replace((0,v.Zs0)(n)))}),[p,D,S,s,n]),{setSelectedBusinessExpenseCode:M,setSelectedBusinessExpenseMemo:F,isValidPaymentSwitch:e=>e===u.Hu.Personal||e===u.Hu.Business,updateDraftOrderPaymentProfile:V,setUseCreditsForManagedBusiness:Z,updateDraftOrderError:p.error}}({selectedBusinessPayment:ne,selectedBusinessProfile:b,selectedBusinessPolicy:g,selectedBusinessExpenseCode:M,selectedBusinessExpenseMemo:H,setSelectedBusinessExpenseCodeFn:F,setSelectedBusinessExpenseMemoFn:T,setPaymentIntent:ie,paymentIntent:te,businessProfiles:D});return e.children({businessPolicies:S,businessProfiles:D,getBusinessProfiles:I,onSelectBusinessProfile:Z,selectedBusinessProfile:b,selectedBusinessPolicy:g,setSelectedBusinessPolicy:G,businessExpenseCodes:O,searchBusinessExpenseCodes:k,selectedBusinessExpenseCode:M,setSelectedBusinessExpenseCode:re,getBackUrl:V,handleBusinessBackButton:w,selectedBusinessExpenseMemo:H,setSelectedBusinessExpenseMemo:ue,requiresProfileFlow:L,selectedBusinessPayment:ne,currentStep:q,hasBusinessProfile:_,selectedPersonalPayment:j,extraPaymentData:K,paymentProfiles:W,creditBalances:Y,paymentIntent:te,setPaymentIntent:ie,getInitialUrl:N,confirmedProfileSelected:A,setConfirmedProfileSelected:z,useCredits:null!=$?$:Y.length>0,user:s,updateSelectedPersonalPayment:J,updateSelectedBusinessPayment:e=>{G(null),n((0,d.Kz)(e)),(null==e?void 0:e.profileType)===u.Hu.Business&&n((0,o.Nc)(null==e?void 0:e.paymentProfileUuid))},updateExtraPaymentData:e=>{n((0,d.n2)(e))},updateUseCredits:(e,s)=>{s===u.Hu.Personal?n((0,d.Pe)(e)):s===u.Hu.Business?n((0,d.sg)(e)):ce(e)},isValidPaymentSwitch:oe,getBusinessDetails:R,updateDraftOrderPaymentProfile:de,updateDraftOrderError:ae,guestPaymentProfile:Q,setGuestPaymentProfile:X})};var D=n(56865),I=n(30330);const Z=t.createContext({businessPolicies:u.TW,businessProfiles:u.zp,getBusinessProfiles:l.Z,selectedBusinessProfile:null,selectedBusinessPolicy:null,setSelectedBusinessPolicy:l.Z,onSelectBusinessProfile:l.Z,businessExpenseCodes:u.$C,searchBusinessExpenseCodes:()=>{},selectedBusinessExpenseCode:null,setSelectedBusinessExpenseCode:l.Z,selectedBusinessExpenseMemo:null,setSelectedBusinessExpenseMemo:l.Z,getBackUrl:()=>({}),handleBusinessBackButton:l.Z,requiresProfileFlow:()=>!1,creditBalances:[],extraPaymentData:null,paymentProfiles:[],updateExtraPaymentData:l.Z,updateSelectedBusinessPayment:l.Z,updateUseCredits:l.Z,useCredits:!1,user:D.V,paymentIntent:"personal",setPaymentIntent:l.Z,updateSelectedPersonalPayment:l.Z,selectedPersonalPayment:null,selectedBusinessPayment:null,currentStep:"PROFILE",getInitialUrl:()=>({}),confirmedProfileSelected:!1,setConfirmedProfileSelected:l.Z,isValidPaymentSwitch:()=>!1,getBusinessDetails:()=>({profileUUID:null,profileType:null,policyUUID:null,policyVersion:null}),updateDraftOrderPaymentProfile:()=>null,updateDraftOrderError:null,hasBusinessProfile:!1,guestPaymentProfile:null,setGuestPaymentProfile:l.Z}),b=()=>{const e=t.useContext(Z);if(null!==e)return e;throw Error("You should use useEditPaymentProfilesContext only in a descendant of EditPaymentProfilesProvider")};function g(e){return(0,I.tZ)(S,{children:s=>(0,I.tZ)(Z.Provider,{value:s,children:e.children})})}}}]);