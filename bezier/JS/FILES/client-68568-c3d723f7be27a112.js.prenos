(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[68568],{66026:(e,t,n)=>{var r="__lodash_hash_undefined__",s="[object Function]",i="[object GeneratorFunction]",a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/,u=/^\./,c=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,l=/\\(\\)?/g,d=/^\[object .+?Constructor\]$/,h="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,m="object"==typeof self&&self&&self.Object===Object&&self,p=h||m||Function("return this")();var g=Array.prototype,f=Function.prototype,v=Object.prototype,_=p["__core-js_shared__"],y=function(){var e=/[^.]+$/.exec(_&&_.keys&&_.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),b=f.toString,Z=v.hasOwnProperty,C=v.toString,O=RegExp("^"+b.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),P=p.Symbol,S=g.splice,x=L(p,"Map"),w=L(Object,"create"),T=P?P.prototype:void 0,M=T?T.toString:void 0;function k(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function E(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function I(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function D(e,t){for(var n=e.length;n--;)if(B(e[n][0],t))return n;return-1}function A(e,t){for(var n=0,r=(t=function(e,t){if(N(e))return!1;var n=typeof e;if("number"==n||"symbol"==n||"boolean"==n||null==e||G(e))return!0;return o.test(e)||!a.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:function(e){return N(e)?e:H(e)}(t)).length;null!=e&&n<r;)e=e[j(t[n++])];return n&&n==r?e:void 0}function R(e){return!(!F(e)||function(e){return!!y&&y in e}(e))&&(function(e){var t=F(e)?C.call(e):"";return t==s||t==i}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?O:d).test(function(e){if(null!=e){try{return b.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e))}function U(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function L(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return R(n)?n:void 0}k.prototype.clear=function(){this.__data__=w?w(null):{}},k.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},k.prototype.get=function(e){var t=this.__data__;if(w){var n=t[e];return n===r?void 0:n}return Z.call(t,e)?t[e]:void 0},k.prototype.has=function(e){var t=this.__data__;return w?void 0!==t[e]:Z.call(t,e)},k.prototype.set=function(e,t){return this.__data__[e]=w&&void 0===t?r:t,this},E.prototype.clear=function(){this.__data__=[]},E.prototype.delete=function(e){var t=this.__data__,n=D(t,e);return!(n<0)&&(n==t.length-1?t.pop():S.call(t,n,1),!0)},E.prototype.get=function(e){var t=this.__data__,n=D(t,e);return n<0?void 0:t[n][1]},E.prototype.has=function(e){return D(this.__data__,e)>-1},E.prototype.set=function(e,t){var n=this.__data__,r=D(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},I.prototype.clear=function(){this.__data__={hash:new k,map:new(x||E),string:new k}},I.prototype.delete=function(e){return U(this,e).delete(e)},I.prototype.get=function(e){return U(this,e).get(e)},I.prototype.has=function(e){return U(this,e).has(e)},I.prototype.set=function(e,t){return U(this,e).set(e,t),this};var H=q((function(e){e=function(e){return null==e?"":function(e){if("string"==typeof e)return e;if(G(e))return M?M.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)}(e);var t=[];return u.test(e)&&t.push(""),e.replace(c,(function(e,n,r,s){t.push(r?s.replace(l,"$1"):n||e)})),t}));function j(e){if("string"==typeof e||G(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function q(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,s=t?t.apply(this,r):r[0],i=n.cache;if(i.has(s))return i.get(s);var a=e.apply(this,r);return n.cache=i.set(s,a),a};return n.cache=new(q.Cache||I),n}function B(e,t){return e===t||e!=e&&t!=t}q.Cache=I;var N=Array.isArray;function F(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function G(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==C.call(e)}e.exports=function(e,t,n){var r=null==e?void 0:A(e,t);return void 0===r?n:r}},41344:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var r=n(45528),s=n(71275),i=n(38370),a=n(82386),o=n(30330);const u=()=>{const e=(0,r.T)();return(0,o.tZ)(s.ZP,{backLocation:(0,i.N0q)(e),children:(0,o.tZ)(a.Z,{})})}},3878:(e,t,n)=>{"use strict";n.d(t,{d:()=>d});var r=n(42044),s=n(95691),i=n(79279),a=n(88992),o=n(26705),u=n(8500),c=n(790),l=n(30330);const d=e=>{const t=(0,o.mY)(e.code,500);return(0,l.BX)(l.HY,{children:[(0,l.tZ)(c.q,{statusCode:t}),(0,l.BX)(u.wP,{children:[(0,l.tZ)(r.Z,{}),(0,l.tZ)(a.Z,{}),(0,l.tZ)(s.Z,{})]}),(0,l.tZ)(u.q6,{children:(0,l.tZ)(o.Qv,{code:t})}),(0,l.tZ)(i.Z,{})]})}},88992:(e,t,n)=>{"use strict";n.d(t,{Z:()=>L});var r=n(18898),s=n(4878),i=n(75713),a=n(31476),o=n(72436),u=n(23619),c=n(34684),l=n(35077),d=n(5147),h=n(38370),m=n(64064),p=n(32912),g=n(25929),f=n(37740),v=n(82673),_=n(10688),y=n(28307),b=n(30330);const Z=function(e){let{numMembers:t,numItems:n,formattedPriceTotal:r}=e;return(0,b.BX)(_.Z,{separator:y.Z,children:[1===t?(0,b.tZ)(v.v,{id:"go.banner_just_you"}):(0,b.tZ)(v.v,{id:"go.cart_items_people_header",data:{numItems:n,numPeople:t}}),r?(0,b.tZ)(v.v,{id:"go.banner_subtotal",data:{subtotal:r}}):null]})};const C=function(e){let{numItems:t,formattedSpendingLimit:n,formattedPriceUserSubtotal:r}=e;return(0,b.tZ)(_.Z,{separator:y.Z,children:n?(0,b.tZ)(v.v,{id:"go.spending_x_of_y_limit",data:{spendingLimit:n,subtotal:r}}):0===t?(0,b.tZ)(v.v,{id:"go.banner_add_items"}):1===t?(0,b.tZ)(v.v,{id:"go.banner_added_items_singular"}):(0,b.tZ)(v.v,{id:"go.banner_added_items_plural",data:{numItems:t}})})};var O=n(56182),P=n(91816),S=n(63745),x=n(89162),w=n(46748),T=n(56706),M=n(17926);const k=(0,o.zo)("div",{display:"flex",flexDirection:"row",alignItems:"center"}),E=(0,o.zo)(m.rU,(e=>{let{$theme:t}=e;return{display:"flex",flexDirection:"row",alignItems:"flex-start",justifyContent:"space-between",padding:"16px",height:"80px",background:t.colors.positive50,boxSizing:"border-box"}})),I=(0,o.zo)("div",{display:"flex",flexDirection:"row",alignItems:"center"}),D=(0,o.zo)("div",{display:"flex",flexDirection:"row",alignItems:"flex-start"}),A=(0,o.zo)("div",{display:"flex",flexDirection:"column"}),R=(0,o.zo)("div",(e=>{let{$theme:t}=e;return t.typography.LabelMedium})),U=(0,o.zo)("div",(e=>{let{$theme:t}=e;return t.typography.ParagraphSmall}));const L=function(){var e,t,n,o;const{serverCart:{data:m}}=(0,s.iQ)(),v=(null==m?void 0:m.items)||[],_=(null==m?void 0:m.numMembers)||1,y=null==m?void 0:m.currencyCode,L=null==m?void 0:m.storeUuid,H=(0,M.Z)(),j=(0,p.TH)(),q=(0,d.Z)(),B=(0,c.Pb)(q,y,v),N=(0,a.gm)(),{hasGroupOrder:F,isDraftOrderCreator:G,creatorName:X,currentUserItemCount:$,currentUserCartItems:z,draftOrderUuid:Q,isBillSplitOrder:K}=(0,l.Z)(),{groupOrder:V,getGroupOrder:J,shouldGetGroupOrder:Y}=(0,P.Z)(Q);(0,S.Z)((()=>Y&&!H?J():null),[Y,J,H],"group-order-desktop-banner");const{orderName:W}=(0,x.Z)(),ee=Boolean(Boolean(null===(e=V.data)||void 0===e?void 0:e.spendingLimitAmount.amount)&&(null===(t=V.data)||void 0===t?void 0:t.spendingLimitAmount.currencyCode)),te=ee&&(0,g.xG)(q,(null===(n=V.data)||void 0===n?void 0:n.spendingLimitAmount.currencyCode)||"",(null===(o=V.data)||void 0===o?void 0:o.spendingLimitAmount.amount)||0)||"";let ne=(0,c.Pb)(q,y,z);ee&&!ne&&(ne="0");const{store:re,getStore:se,shouldGetStore:ie}=(0,O.Z)(L);r.useEffect((()=>{ie&&se()}),[ie,se]);const{inGroupOrderV2XP:ae,hasBillSplit:oe}=(0,T.Z)(),ue=(0,w.Z)();if(r.useEffect((()=>{G&&F&&X&&!ae&&!H&&ue(!1)}),[G,F,X,ae,ue,H]),!F||!X||H)return null;const ce=re.data;if(!ce)return null;const le=(0,c.dH)(v),de=G||oe&&K;return(0,b.BX)(E,{to:de?(0,h.nQQ)(j):(0,h.Kes)(j,(0,h.Btk)(ce)),children:[(0,b.tZ)(I,{children:(0,b.BX)(D,{children:[(0,b.tZ)(i.Z,{type:"People"}),(0,b.tZ)(u.IQ,{}),(0,b.BX)(A,{children:[(0,b.tZ)(R,{children:W}),(0,b.tZ)(f.ZP,{$height:4}),(0,b.tZ)(U,{children:G?(0,b.tZ)(Z,{numMembers:_,numItems:le,formattedPriceTotal:B}):(0,b.tZ)(C,{numItems:$,formattedSpendingLimit:te,formattedPriceUserSubtotal:ne})})]})]})}),(0,b.tZ)(k,{children:(0,b.tZ)(i.Z,{type:"ArrowLeft",rotate:"rtl"===N?0:180})})]})}},70515:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Y});var r=n(77808);const s=()=>{},i=e=>!(!e||"object"!=typeof e)&&("function"==typeof e.timing&&"function"==typeof e.increment),a=()=>({increment:s,timing:s}),o=e=>{try{const t=JSON.parse(e);return"object"==typeof t?t:{}}catch(e){return{}}},u=e=>{let t=!1;return(n,r)=>{t||(t=!0,e(n,r))}},c=(e,t)=>{if(e.xhr.readyState===e.xhr.UNSENT||e.xhr.readyState===e.xhr.DONE)return;Date.now()-e.lastResponse>t&&e.xhr.abort(),setTimeout(c,t,e,t)};function l(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?e=>e:1===t.length?t[0]:t.reduce(((e,t)=>function(){return e(t(...arguments))}))}const d={ACK:"/events/ack",RECV:"/events/recv"},h={dca1:"dca",phx2:"phx"},m=(e,t,n)=>{switch(n){case"sameorigin":return"/ramen".concat(h[t]).concat(d[e]||"");case"breeze":return"https://ramen".concat(h[t],".uber.com").concat(d[e]||"");case"openid":return"https://ramen".concat(h[t],".uberinternal.com").concat(d[e]||"");default:return"https://cn-".concat(t,".uber.com/ramen").concat(d[e]||"")}},p={altitude:"x-uber-device-location-altitude",app:"x-uber-client-name",authorization:"Authorization",device:"x-uber-device",deviceId:"x-uber-device-id",deviceIds:"x-uber-device-ids",deviceModel:"x-uber-device-model",deviceOS:"x-uber-device-os",epoch:"x-uber-device-epoch",language:"x-uber-device-language",latitude:"latitude",longitude:"longitude",origin:"x-uber-origin",regionId:"x-uber-region-id",service:"x-uber-push-service",source:"x-uber-source",token:"x-uber-token",uuid:"x-uber-uuid",version:"x-uber-client-version",screenflowVersion:"x-uber-screenflow-client-version",appVariant:"x-uber-app-variant"},g=e=>(e.hasOwnProperty("device")||(e.device="web"),Object.keys(e).map((t=>{const n=p[t],r=e[t];if(n&&r)return[n,e[t]]})).filter(Boolean)),f=(e,t)=>e.slice(-1)===t?e.slice(0,-1):e,v=new RegExp(/\n\n$/),_=new RegExp(/^(close|data|event|id|):\s?(.*)/),y=e=>{let[t,n]=["",""];const r=_.exec(e);return r&&3===r.length&&([,t,n]=r),e.length>0&&!e.includes(":")&&(t=e),[t,n]},b=(e,t,n)=>{switch(t){case"event":e.name=n;break;case"data":e.data="".concat(e.data||"").concat(n,"\n");break;case"id":e.id=n}return e},Z=e=>{let t={data:"",name:""},n="";return r=>{if(n+=r,v.test(n)){n=f(n,"\n");for(const r of n.split("\n")){if(""===r){t.data=f(t.data||"","\n"),e(t),t={data:"",name:""},n="";continue}if(":"===r[0])continue;const[s,i]=y(r);t=b(t,s,i)}}}};var C=n(44398);function O(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const P=e=>"function"==typeof e?e():null,S=(e,t,n)=>({code:t,error:n,stopped:e});class x{constructor(e){O(this,"authenticateUser",(e=>{if(!this.authenticationMethod||"sameorigin"===this.authenticationMethod)return void e();if("undefined"==typeof fetch||fetch.polyfill)return void e(S(!0,"unsupported_browser"));const t=m("ACK",this.session.datacenter,this.authenticationMethod);fetch("".concat(t,"?seq=-1"),{credentials:"include",mode:"no-cors"}).then((e=>e.ok?e:fetch("".concat(t,"?seq=-1"),{credentials:"include"}))).then((t=>{const n=200===t.status?void 0:S(!0,"authentication_failed");e(n)})).catch((t=>e(S(!0,"authentication_failed",t))))})),O(this,"startPolling",(e=>{const t=m("RECV",this.session.datacenter,this.authenticationMethod),n="".concat(t,"?seq=").concat(this.session.seq),r=[...g(this.user),["cache-control","no-cache"],["x-uber-client-session",this.session.uuid],this.user.uuid?["x-auth-params-user-uuid",this.user.uuid]:null].filter(Boolean);this.session.stopPolling=((e,t)=>{const n=new XMLHttpRequest,r=u(t.onDisconnect),s=u(t.onConnect),i={lastResponse:Date.now(),xhr:n};let a=0,o=0;return n.onreadystatechange=()=>{if(n.readyState===n.LOADING||n.readyState===n.DONE){n.status<400&&s(null),i.lastResponse=Date.now();const e=n.responseText.substring(o);o=n.responseText.length,t.callback(e)}const e=n.readyState<a;if(a=Math.max(n.readyState,a),n.readyState===n.DONE||e){let s={connectionClosed:n.readyState===n.DONE,responseText:n.responseText,statusCode:n.status,timestamp:(new Date).toISOString(),userAborted:e};t.returnHeaders&&(s={...s,requestHeaders:n._headers,responseHeaders:n.responseHeaders}),r(null,s)}},n.onerror=e=>{n.abort(),r(new Error(e))},n.open("GET",e),n.withCredentials=!0,t.headers.map((e=>{let[t,r]=e;return n.setRequestHeader(t,r)})),n.send(),i.lastResponse=Date.now(),c(i,t.disconnectInterval),()=>n.abort()})(n,{callback:l(Z(this.handleEvent),this.maybeSendAck),disconnectInterval:2e4,headers:r,onDisconnect:e,returnHeaders:this.returnHeaders,onConnect:()=>{this.manager&&this.manager.notifyConnection(this)}})})),O(this,"retryPolling",(()=>{const e=Date.now();this.m3Client.increment("request",{method:"recv"}),this.didFirstPoll||(this.m3Client.timing("client-ready",Date.now()-this.initTimestamp),this.didFirstPoll=!0),this.startPolling(((t,n)=>{this.session.active?(t?this.callback(S(!1,"client_error",t),null,this):this.callback(S(!1,"client_disconnected",n),null,this),this.m3Client.timing("latency",Date.now()-e,{method:"recv"}),setTimeout(this.retryPolling,5e3)):this.callback(S(!0,"session_inactive",t),null,this)}))})),O(this,"sendAck",(()=>{const e=m("ACK",this.session.datacenter,this.authenticationMethod),t=Date.now();this.m3Client.increment("request",{method:"ack"}),((e,t,n)=>{const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(r.readyState===r.DONE){if(r.status<200||r.status>=300){let e={message:r.responseText,status:r.status};return t.returnHeaders&&(e={...e,requestHeaders:r._headers,responseHeaders:r.responseHeaders}),void n(e)}n(null,o(r.responseText))}},r.open(t.method,e),r.timeout=t.timeout||3e4,r.withCredentials=!0,t.headers.map((e=>{let[t,n]=e;return r.setRequestHeader(t,n)})),r.send(t.body||null)})("".concat(e,"?seq=").concat(this.session.seq),{headers:[...g(this.user),["x-uber-client-session",this.session.uuid],this.user.uuid?["x-auth-params-user-uuid",this.user.uuid]:null].filter(Boolean),method:"GET",returnHeaders:this.returnHeaders},(e=>{e&&this.callback(S(!1,"ack_failed",e),null,this),this.m3Client.timing("latency",Date.now()-t,{method:"ack"})}))})),O(this,"handleEvent",(e=>{if((e=>!(e.name||e.data||e.seq))(e))return;if("close"===e.name)return void P(this.session.stopPolling);const{msg:t}=o(e.data);"rmn-msg-v1"===e.name&&Array.isArray(t)?t.map(this.handleMessage):this.callback(S(!1,"unrecognised_message",e),null,this)})),O(this,"handleMessage",(e=>{Number.isFinite(e.seq)&&e.seq>this.session.seq&&(this.session.seq=e.seq),this.callback(null,e,this)})),O(this,"stop",(()=>{this.session.active=!1,P(this.session.stopPolling)})),this.callback=e.callback,this.user=e.user,this.manager=e.manager,this.authenticationMethod=e.authenticationMethod,this.session={active:!0,datacenter:e.datacenter,seq:0,uuid:(0,C.Z)()},this.m3Client=i(e.m3Client)?e.m3Client:a(),this.initTimestamp=Date.now(),this.didFirstPoll=!1,e.returnHeaders&&(this.returnHeaders=!0),this.authenticateUser((e=>{if(e)return this.session.active=!1,void this.callback(e,null,this);this.maybeSendAck=((e,t)=>{let n=Date.now();return r=>(Date.now()-n>=t&&(n=Date.now(),e()),r)})(this.sendAck,3e4),this.retryPolling()}))}}var w=n(66026),T=n.n(w);const M=["phx2","dca1"];const k=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.user)throw new Error("RamenJS init error: `options.user` is required");if(!e.user.app)throw new Error("RamenJS init error: `options.user.app` is a required field");this.handlers={message:[],connect:[],disconnect:[],error:[]},this.clients=[],this.disconnectionTimeout=e.disconnectionTimeout||15e3,this.user=e.user;const t=e.dc||e.datacenter||M;return this.dcs=(Array.isArray(t)?t:[t]).reduce(((e,t)=>(e[t]={status:"disconnected",timeout:null},e)),{}),this.authenticationMethod=e.authenticationMethod||"sameorigin",this.m3Client=i(e.m3Client)?e.m3Client:a(),this.mockedClient=e.mockedClient||!1,this}on(e,t){return this.handlers.hasOwnProperty(e)&&(this.handlers[e].push(t),this.initializeClients()),this}off(e,t){if(!this.handlers.hasOwnProperty(e))return this;if(!t&&this.handlers[e].length)this.handlers[e]=[];else{const n=this.handlers[e].indexOf(t);-1!==n&&this.handlers[e].splice(n,1)}return this.hasSubscribers()||this.stopClients(),this}initializeClients(){this.clients.length||this.mockedClient||Object.keys(this.dcs).forEach((e=>{const t=new x({datacenter:e,user:this.user,authenticationMethod:this.authenticationMethod,m3Client:this.m3Client,callback:this.handleClientResponse.bind(this),manager:this});this.clients.push(t)}))}handleClientResponse(e,t,n){if(e){const t=n.session.datacenter;this.dcs[t]&&(this.dcs[t].lastError=e,this.dcs[t].timeout||"disconnected"===this.dcs[t].status||(this.dcs[t].timeout=setTimeout((()=>{this.dcs[t].status="disconnected",this.dcs[t].timeout=null,this.trigger("disconnect",{...this.getConnectionStatus(),error:this.dcs[t].lastError},n)}),this.disconnectionTimeout))),this.trigger("error",e,n)}else if(t){let e=t.msg;try{e=JSON.parse("".concat(e))}catch(e){this.trigger("error","parsing error ".concat(e),n)}this.trigger("message",{...t,msg:e},n)}}trigger(e,t,n){const r=n?{dc:T()(n,"session.datacenter")}:{};this.handlers[e].forEach((e=>{e(t,r)}))}stopClients(){}hasSubscribers(){for(let e of Object.keys(this.handlers))if(this.handlers[e].length)return!0;return!1}getConnectionStatus(){let e=!1,t=!1;return{details:Object.keys(this.dcs).reduce(((n,r)=>{const s=this.dcs[r].status;return"connected"===s?t=!0:e=!0,n[r]=s,n}),{}),status:t?e?"limited":"connected":"disconnected"}}notifyConnection(e){const t=e.session.datacenter,n=T()(this.dcs[t],"timeout");clearTimeout(n);let r="connected"!==T()(this.dcs[t],"status");this.dcs[t]={status:"connected",timeout:null,lastError:null},r&&this.trigger("connect",this.getConnectionStatus(),e)}};var E=n(32912),I=n(77067),D=n(76448),A=n(60496);var R=n(33284),U=n(21888),L=n(30778),H=n(55177),j=n(38370),q=n(86087),B=n(5147),N=n(58930),F=n(68175),G=n(17924),X=n(29808),$=n(75666),z=n(22172),Q=n(80350),K=n(82570),V=n(76039),J=n(95593);const Y=()=>{var e;const t=(0,X.Z)(),n=(0,B.Z)(),s=(0,q.ZP)(),i=(0,E.k6)(),a=(0,E.TH)(),o=(0,I.Z)(),{user:u}=(0,D.Z)(),c=null===(e=u.data)||void 0===e?void 0:e.isLoggedIn;let l=(0,A.Z)("web_ramen");const d=(0,A.Z)("cookie_promo"),h=(0,A.Z)("home_membership_modal"),m=(0,L.I0)(),p=(0,U.v)((e=>{let{ramen:t}=e;return t})),g=(0,r.useRef)(0),{updateRamenPromoUuidInStorage:f}=(0,H.Z)(),v=(0,r.useRef)(null),_=(0,r.useRef)({}),y="postmates"===(0,N.Z)(),b=(0,G.kR)(t),Z=function(){const e=(0,E.TH)(),{getEaterMessageInterstitialSessionCapper:t}=(0,z.Z)(),n=(0,A.Z)("eater_message_interstitials"),s=(0,q.ZP)(),i=(0,$.Z)(),{isSavingsLanding:a,isSavingsLandingInterstitial:o}=(0,K.Z)(),u=a||o;return(0,r.useCallback)((r=>{if(r.messages&&r.messages.length>0){var a;const o=r.messages[0],c=i({surface:o.surface,surfaceId:o.surfaceId,...o.message});s("eats:eater_message_ramen_log",{eaterMessage:{ramenMsg:JSON.stringify(r),surface:o.surfaceId||"UNKNOWN"}});const l=null==c?void 0:c.payload,d=String(J.parse(e.search)[j.FSm.modalName]),h=["pendingRating","ratingSubmitted","orderRating"].includes(d),m=l&&"modalPayload"===l.type&&null!==(a=null==l?void 0:l.modalPayload.uuid)&&void 0!==a?a:"",{hasPromotionBanner:p}=(0,Q.X1)(c);switch(o.surfaceId){case"HOME_FEED_PUSH_BOTTOM_MODAL":return n&&!t("HOME_FEED_PUSH_BOTTOM_MODAL",m)&&!!c&&!p&&!u&&!!(0,E.LX)(e.pathname,V.r.home_feed);case"VERTICAL_FEED_PUSH_BOTTOM_MODAL":return n&&!t("VERTICAL_FEED_PUSH_BOTTOM_MODAL",m)&&!!c&&!!(0,E.LX)(e.pathname,V.r.vertical_feed);case"ORDER_TRACKING_PUSH_BOTTOM_MODAL":return n&&!t("ORDER_TRACKING_PUSH_BOTTOM_MODAL",m)&&!!c&&!(0,E.LX)(e.pathname,V.r.vertical_feed);case"ORDER_COMPLETE_PUSH_BOTTOM_MODAL":return n&&!t("ORDER_COMPLETE_PUSH_BOTTOM_MODAL",m)&&!h&&!!c;default:return!1}}return!1}),[e.search,e.pathname,n,t,s,i,u])}(),O=(0,r.useContext)(F.k),P=(0,r.useCallback)((e=>{O.set("chatMessageUuid",e)}),[O]),S=(0,r.useCallback)((e=>{switch(e.type){case"eater_push_messages":{var t;const{promoUUID:r,isAutoApplyPromo:o,promoType:u,projectType:c}=(null===(t=e.msg.eaterMetadata)||void 0===t?void 0:t.eaterPromoMetadata)||{};var n;if(s("eats:thin_mint_ccc_ramen_message",{promoInterstitial:{promoUuid:r||"",isAutoApply:Boolean(o),promoType:u||"",projectType:c||"",ramenUuid:e.uuid}}),f(e.uuid),d&&e.msg.pushMessage)null!==(n=e.msg.pushMessage)&&void 0!==n&&n.miniInterstitial?i.replace((0,j.oOH)(a,{ramenPromoUuid:e.uuid})):(0,E.LX)(a.pathname,j.y9b)&&i.push((0,j.d1)(a));return}case"chat":return void("system"!==e.msg.messageType&&P(e.uuid));case"eater_message_service_screen_messages":if(Z(e.msg)){const t=(e.msg.messages||[])[0].surfaceId||"";i.push((0,j.tLx)(a,t))}return;case"home_membership_modal":return void(h&&(s("eats:home_membership_modal_ramen_message_received"),i.push((0,j.bAD)(a,e.uuid))));default:return}}),[s,i,d,a,f,P,Z,h]);return(0,r.useEffect)((()=>{if(p.messageQueue.length>0&&g.current<p.messageQueue.length){const e=p.messageQueue.length-1,t=p.messageQueue[e];S(p.messageMap[t]),g.current=p.messageQueue.length}}),[S,p]),(0,r.useEffect)((()=>{l&&c&&!v.current&&(v.current=new k({m3Client:o,user:{app:"eats_web",device:"eats-web",deviceId:b||(0,C.Z)(),language:n,origin:"eats-web",source:"eats-web",version:"1.0.0",appVariant:y?"postmates":"ubereats"}}).on("message",(e=>{const t=function(e){if(!e||"object"!=typeof e)return null;const t=function(e){const{priority:t,seq:n,uuid:r}=e;return t&&n&&r?{priority:t,seq:n,uuid:r}:null}(e);if(!t)return null;switch(e.type){case"eater_push_messages":return{type:"eater_push_messages",...t,msg:e.msg||{}};case"eater_menu_actions":return{type:"eater_menu_actions",...t,msg:e.msg||{}};case"chat":return{type:"chat",...t,msg:e.msg||{}};case"eater_message_service_screen_messages":return{type:"eater_message_service_screen_messages",...t,msg:e.msg||{}};case"home_membership_modal":return{type:"home_membership_modal",...t,msg:e.msg||{}};default:return null}}(e);return t&&!_.current[t.uuid]&&m((0,R.l)(t)),t&&(_.current[t.uuid]=!0),()=>{v.current&&v.current.off("message")}})))}),[m,c,l,n,o,y,b]),null}},43568:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(21888),s=n(35768);const i=()=>(0,r.v)((e=>{let{features:t}=e;return t}))[s.h6.capital_one_promo]},29309:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(21888),s=n(35768);const i=()=>(0,r.v)((e=>{let{features:t}=e;return t}))[s.h6.disney_redemption_state]},22172:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(77808),s=n(43709),i=n(29808),a=n(17924);function o(){const e=(0,i.Z)(),t=(0,a.Yk)(e),n=(0,s._)();return{getEaterMessageInterstitialSessionCapper:(0,r.useCallback)(((e,r)=>{const s=(n.get("eater-message-interstitial-session-capper")||{})[e];return!(!s||s.sessionId!==t||!s.campaigns)&&s.campaigns.includes(r)}),[n,t]),setEaterMessageInterstitialSessionCapper:(0,r.useCallback)(((e,r)=>{const s=n.get("eater-message-interstitial-session-capper")||{},i=s[e];let a=(null==i?void 0:i.sessionId)===t&&null!=i&&i.campaigns?i.campaigns:[];a.includes(r)||a.push(r),n.set("eater-message-interstitial-session-capper",{...s,[e]:{sessionId:t,campaigns:a}})}),[n,t])}}},55177:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(77808),s=n(21888),i=n(45528),a=n(68175),o=n(32142),u=n(38370),c=n(86087);function l(){var e,t,n,l;const d=(0,c.ZP)(),h=(0,i.T)(),m=(0,r.useContext)(a.k),p=(0,s.v)((e=>{let{ramen:t}=e;return t})),{applyPromo:g,appliedPromo:f}=(0,o.Z)(),v=m.get("ramenPromoClaimed")||!1,[_,y]=(0,r.useState)(Boolean(v)),{ramenPromoUuid:b}=(0,u.RAN)(h,["ramenPromoUuid"]),Z=b||String(m.get("ramenPromoUuid"))||"",C=p.messageMap[Z],O=C&&"eater_push_messages"===C.type?C.msg:null,P=null==O||null===(e=O.pushMessage)||void 0===e?void 0:e.interstitial,S=null==O||null===(t=O.pushMessage)||void 0===t?void 0:t.miniInterstitial,x=null==O||null===(n=O.pushMessage)||void 0===n?void 0:n.fullScreenInterstitial,w=null==O||null===(l=O.eaterMetadata)||void 0===l?void 0:l.eaterPromoMetadata,T=(0,r.useMemo)((()=>({promoUuid:(null==w?void 0:w.promoUUID)||"",isAutoApply:Boolean(null==w?void 0:w.isAutoApplyPromo),promoType:(null==w?void 0:w.promoType)||"",projectType:(null==w?void 0:w.projectType)||"",ramenUuid:Z})),[null==w?void 0:w.promoUUID,null==w?void 0:w.isAutoApplyPromo,null==w?void 0:w.projectType,null==w?void 0:w.promoType,Z]);(0,r.useEffect)((()=>{f.hasLoaded&&!f.error&&(y(!0),m.set("ramenPromoClaimed",!0))}),[f.error,f.hasLoaded,m]);const M=(0,r.useCallback)((e=>{m.set("ramenPromoUuid",e)}),[m]),k=(0,r.useCallback)((e=>{g({code:e,onSuccess:()=>{d("eats:thin_mint_ccc_claim_success",{promoInterstitial:T})},onFailure:()=>{d("eats:thin_mint_ccc_claim_failure",{promoInterstitial:T})}})}),[g,d,T]);return{interstitial:P,miniInterstitial:S,fullScreenInterstitial:x,metadata:w,ramenPromoUuid:Z,updateRamenPromoUuidInStorage:M,applyCookiePromo:k,appliedPromo:f,isPromoClaimed:_,eventData:T}}},77067:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(37424),s=n(7811);function i(){return(0,r.G2)(s.EK)}}}]);